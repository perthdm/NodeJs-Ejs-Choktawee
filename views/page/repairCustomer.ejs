<%- include('../layouts/header', {title: 'ซ่อมรถ'}); -%>
<%- include('../layouts/css'); -%>
<%- include('../layouts/endheader'); -%>
<%- include('../layouts/sidebar',{active:'home'}); -%>
<%- include('../layouts/topbar'); -%>



<!-- contenr -->



<div class="content" id="step1" style="display:block">
    <div class="title margin-top-30">
        <img src="/images/repair.svg" width="200px">
        <span> ซ่อมรถ : ข้อมูลลูกค้า</span>
        <div class="line"></div>
    </div>
    <center>
        <div class="stepwizard">
            <div class="stepwizard-row">
                <div class="stepwizard-step">
                    <button type="button" class="btn-circle btn-green-step">1</button>
                    <p class="color-green">ข้อมูลลูกค้า</p>
                </div>
                <div class="stepwizard-step">
                    <button type="button" class="btn-circle" disabled="disabled">2</button>
                    <p>ข้อมูลรถ</p>
                </div>
                <div class="stepwizard-step">
                    <button type="button" class="btn-circle" disabled="disabled">3</button>
                    <p>สรุปการทำรายการ</p>
                </div>
                <div class="stepwizard-step">
                    <button type="button" class="btn-circle" disabled="disabled">4</button>
                    <p>การทำรายการสำเร็จ</p>
                </div>
            </div>
        </div>
    </center>



    <div class="row">

        <div class="form-group col">
            <input type="text" list="brow" class="form-control" maxlength="30" id="inputSearch"
                placeholder="ค้นหารหัส/ชื่อลูกค้า" onchange="showData()">
            <datalist id="brow">
                <% for(let i = 0 ; i < result.length ; i++) { %>
                <option style="background-color:red !important;"
                    value="<%= i+1 %> | <%= result[i].firstname %> <%= result[i].lastname %>"></option>
                <% } %>
            </datalist></div>

        <div class="form-group col-2">
            <a href="/customer/addCustomer">
                <button class="btn-green btn-full"><span><i class="fas fa-plus-circle"></i> เพิ่มลูกค้า</span></button>
            </a>
        </div>

    </div>
    <!-- STEP 1 -->
    <div id="form">
        <div class="row">
            <div class="form-group col">
                <label for="inputEmail4">ชื่อ</label>
                <input readonly type="text" class="form-control" name="firstname" id="firstname" maxlength="30">
                <input hidden id="_id">
            </div>
            <div class="form-group col">
                <label for="inputEmail4">นามสกุล</label>
                <input readonly type="text" class="form-control" id="lastname" maxlength="30">
            </div>
        </div>

        <div class="row">
            <div class="form-group col">
                <label for="inputAddress">เลขประจำตัวประชาชน/เลขผู้เสียภาษี</label>
                <input readonly type="text" class="form-control" id="idCard" maxlength="13">
            </div>
            <div class="form-group col">
                <label for="inputAddress">วัน เดือน ปีเกิด</label>
                <input readonly type="date" class="form-control" id="birthday">

            </div>
        </div>

        <div class="row">
            <div class="form-group col">
                <label for="inputAddress">E-mail</label>
                <input readonly type="text" class="form-control" id="email" maxlength="30">
            </div>
            <div class="form-group col">
                <label for="inputAddress">เบอร์โทรศัพท์</label>
                <input readonly type="text" class="form-control" id="tel" maxlength="10">
            </div>
        </div>
        <div class="row">
            <div class="form-group col">
                <label for="inputEmail4">ที่อยู่</label>
                <input readonly type="text" class="form-control" id="addressNumber" maxlength="30">
            </div>
            <div class="form-group col">
                <label for="inputEmail4">ถนน</label>
                <input readonly type="text" class="form-control" id="street" maxlength="30">
            </div>
            <div class="form-group col">
                <label for="inputEmail4">ตำบล/เขต</label>
                <input readonly type="text" class="form-control" id="subdistrict" maxlength="30">
            </div>

        </div>

        <div class="row">
            <div class="form-group col">
                <label for="inputEmail4">อำเภอ</label>
                <input readonly type="text" class="form-control" id="district" maxlength="30">
            </div>
            <div class="form-group col">
                <label for="inputEmail4">จังหวัด</label>
                <input readonly type="text" class="form-control" id="province" maxlength="30">


            </div>
            <div class="form-group col">
                <label for="inputEmail4">รหัสไปรษณีย์</label>
                <input readonly type="text" class="form-control" id="zipCode" maxlength="5">
            </div>
        </div>

        <div class="row margin-top-30">
            <div class="col text-left"></div>
            <div class="col text-right"><button onclick="validateForm()" class="btn-green "><span>ถัดไป</span></button>
            </div>
        </div>
    </div>

</div>
<!-- STEP 1 -->




<!-- STEP2 -->
<div id="formStep2">
    <div class="content" id="step2" style="display:none;">

        <!-- title -->
        <div class="title margin-top-30">
            <img src="/images/repair.svg" width="200px">
            <span> ซ่อมรถ : ข้อมูลรถ</span>
            <div class="line"></div>
        </div>
        <!-- title -->

        <center>
            <div class="stepwizard">
                <div class="stepwizard-row">
                    <div class="stepwizard-step">
                        <button type="button" class="btn-circle btn-green-step">1</button>
                        <p class="color-green">ข้อมูลลูกค้า</p>
                    </div>
                    <div class="stepwizard-step">
                        <button type="button" class="btn-circle btn-green-step">2</button>
                        <p class="color-green">ข้อมูลรถ</p>
                    </div>
                    <div class="stepwizard-step">
                        <button type="button" class="btn-circle" disabled="disabled">3</button>
                        <p>สรุปการทำรายการ</p>
                    </div>
                    <div class="stepwizard-step">
                        <button type="button" class="btn-circle" disabled="disabled">4</button>
                        <p>การทำรายการสำเร็จ</p>
                    </div>
                </div>
            </div>
        </center>

        <div class="row">
            <div class="form-group col">
                <label>ยี่ห้อ</label>
                <input type="text" class="form-control" id="brand">
            </div>
            <div class="form-group col">
                <label>รุ่น</label>
                <input type="text" class="form-control" id="model">

            </div>
        </div>

        <div class="row">
            <div class="form-group col">
                <label>หมายเลขตัวถัง</label>
                <input type="text" class="form-control" id="chassisNo">
            </div>
            <div class="form-group col">
                <label>หมายเลขเครื่องยนต์</label>
                <input type="text" class="form-control" id="engineNo">
            </div>
            <div class="form-group col">
                <label>เลขทะเบียน</label>
                <input type="text" class="form-control" id="no">
            </div>
        </div>
        <div class="row">
            <div class="form-group col">
                <label>เชื้อเพลิง</label>
                <input type="text" class="form-control" id="fuel">
            </div>
            <div class="form-group col">
                <label>สี</label>
                <input type="text" class="form-control" id="color">

            </div>

            <div class="form-group col">
                <label>รุ่นปี</label>
                <input type="text" class="form-control" id="year">
            </div>

        </div>

        <div class="form-group">
            <label>รายละเอียดการซ่อม</label>
            <textarea class="form-control"
                style="width:-webkit-fill-available; max-width: -webkit-fill-available; height:200px"
                id="detail"></textarea>
        </div>


        <div class="row margin-top-30">
            <div class="col text-left">
                <button class="btn-green" onclick="btBackStep2()"> กลับ </button>
            </div>

            <div class="col text-right">
                <button class="btn-green" onclick="validateForm2()">ถัดไป</button>
            </div>
        </div>
    </div>
</div>
<!-- STEP 2 -->

<!-- STEP3 -->
<div class="content" id="step3" style="display:none;">

    <!-- title -->
    <div class="title margin-top-30">
        <img src="/images/repair.svg" width="200px">
        <span> ซ่อมรถ : สรุปการทำรายการ</span>
        <div class="line"></div>
    </div>
    <!-- title -->

    <center>
        <div class="stepwizard">
            <div class="stepwizard-row">
                <div class="stepwizard-step">
                    <button type="button" class="btn-circle btn-green-step">1</button>
                    <p class="color-green">ข้อมูลลูกค้า</p>
                </div>
                <div class="stepwizard-step">
                    <button type="button" class="btn-circle btn-green-step">2</button>
                    <p class="color-green">ข้อมูลทะเบียน</p>
                </div>
                <div class="stepwizard-step">
                    <button type="button" class="btn-circle btn-green-step">3</button>
                    <p class="color-green">สรุปการทำรายการ</p>
                </div>
                <div class="stepwizard-step">
                    <button type="button" class="btn-circle" disabled="disabled">4</button>
                    <p>การทำรายการสำเร็จ</p>
                </div>
            </div>
        </div>
    </center>

    <div class="row">
        <div class="form-group col text-green">
            <b>ข้อมูลลูกค้า </b>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div style="padding-left: 30px">ชื่อ-นามสกุล : <span id="ConfirmFirstname"></span> <span
                    id="ConfirmLastname"></span>
                <br> เลขประจำตัวประชาชน/เลขที่ผู้เสียภาษี : <span id="ConfirmIdCard"></span>
                <br> ที่อยู่ : <span id="ConfirmAddress"></span>

            </div>
        </div>

        <div class="col">
            <div style="padding-right: 30px">
                E-mail : <span id="ConfirmEmail"></span>
                <br> เบอร์โทรศัพท์ : <span id="ConfirmTel"></span>
            </div>
        </div>
    </div>
    <br>


    <div class="row">
        <div class="form-group col text-green">
            <b>ข้อมูลรถ</b>
        </div>
    </div>
    <div class="row">
        <div class="col ">
            <div style="padding-left: 30px">
                ยี่ห้อ : <span id="ConfirmBrand"></span> <br> หมายเลขตัวถัง : <span id="ConfirmChassisNo"></span> <br>
                เลขทะเบียน : <span id="ConfirmNo"></span> <br> สี : <span id="ConfirmColor"></span> <br>
            </div>

        </div>


        <div class="col">
            <div style="padding-right: 30px">
                รุ่น : <span id="ConfirmModel"></span> <br> หมายเลขเครื่องยนต์ : <span id="ConfirmEngineNo"></span> <br>
                เชื้อเพลิง : <span id="ConfirmFuel"></span> <br> รุ่นปี : <span id="ConfirmYear"></span>
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="form-group col text-green">
            <b>รายละเอียดการซ่อม</b>
        </div>
    </div>

    <div class="row">
        <div style="padding-left: 30px" class="text-left col">
            <p id="ConfirmDetail"></p>
        </div>
    </div>

    <form action="/repair/addRepairOrder" method="POST">
        <input type="text" id="_idHidden" name="_id" hidden>
        <input type="text" id="brandHidden" name="brand" hidden>
        <input type="text" id="modelHidden" name="model" hidden>
        <input type="text" id="chassisNoHidden" name="chassisNo" hidden>
        <input type="text" id="engineNoHidden" name="engineNo" hidden>
        <input type="text" id="noHidden" name="no" hidden>
        <input type="text" id="fuelHidden" name="fuel" hidden>
        <input type="text" id="colorHidden" name="color" hidden>
        <input type="text" id="yearHidden" name="year" hidden>
        <input type="text" id="detailHidden" name="detail" hidden>
        <div class="row margin-top-30">
            <div class="col text-left">
                <button class="btn-green" onclick="btBackStep3()"> กลับ </button>
            </div>
            <div class="col text-right">
                <button class="btn-green" type="submit"> ยืนยัน </button>
            </div>
        </div>

    </form>
    <!-- STEP 3 -->



    </body>

    </html>
    <%- include('../layouts/javascript'); -%>


    <script src="/js/jquery-3.3.1.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        let data = JSON.parse('<%- JSON.stringify(result) %>');



        function showData() {
            var str = document.getElementById("inputSearch").value;
            var res = str.split(" | ");
            var index = parseInt(res[0]) - 1;


            var strDate = new Date(data[index].birthday);
            var year = strDate.getFullYear();
            var month = strDate.getMonth().toString().padStart(2, '0');
            var date = (strDate.getDate()).toString().padStart(2, '0');
            $("#_id").val(data[index]._id);
            $('#birthday').val(year + '-' + month + '-' + date);
            $("#firstname").val(data[index].firstname);
            $("#lastname").val(data[index].lastname);
            $("#idCard").val(data[index].idCard);
            $("#email").val(data[index].email);
            $("#tel").val(data[index].tel);
            $("#addressNumber").val(data[index].address.addressNumber);
            $("#street").val(data[index].address.street);
            $("#subdistrict").val(data[index].address.subdistrict);
            $("#district").val(data[index].address.district);
            $("#province").val(data[index].address.province);
            $("#zipCode").val(data[index].address.zipCode);

        }

        //---------- PAGE1 ----------//
        function btNextStep1() {
            document.getElementById("step1").style.display = "none";
            document.getElementById("step2").style.display = "block";
        }
        //---------- PAGE1 ----------//


        //---------- PAGE2 ----------//
        function btBackStep2() {
            document.getElementById("step2").style.display = "none";
            document.getElementById("step1").style.display = "block";
        }

        function btNextStep2() {
            document.getElementById("step2").style.display = "none";
            document.getElementById("step3").style.display = "block";

            // --- Set In Step3
            $('#ConfirmFirstname').text($('#firstname').val());
            $('#ConfirmLastname').text($('#lastname').val());
            $('#ConfirmIdCard').text($('#idCard').val());
            $('#ConfirmEmail').text($('#email').val());
            $('#ConfirmTel').text($('#tel').val());
            $('#ConfirmAddress').text("");
            $('#ConfirmAddress').append($('#addressNumber').val() + ' ' +
                $('#street').val() + ' ' +
                $('#subdistrict').val() + ' ' +
                $('#district').val() + ' ' +
                $('#province').val() + ' ' +
                $('#zipCode').val())
            $('#ConfirmBrand').text($('#brand').val());
            $('#ConfirmModel').text($('#model').val());
            $('#ConfirmChassisNo').text($('#chassisNo').val());
            $('#ConfirmEngineNo').text($('#engineNo').val());
            $('#ConfirmNo').text($('#no').val());
            $('#ConfirmFuel').text($('#fuel').val());
            $('#ConfirmColor').text($('#color').val());
            $('#ConfirmYear').text($('#year').val());
            $('#ConfirmDetail').text($('#detail').val());

            // --- Hidden --- //

            $('#_idHidden').val($('#_id').val());
            $('#brandHidden').val($('#brand').val());
            $('#modelHidden').val($('#model').val());
            $('#chassisNoHidden').val($('#chassisNo').val());
            $('#engineNoHidden').val($('#engineNo').val());
            $('#noHidden').val($('#no').val());
            $('#fuelHidden').val($('#fuel').val());
            $('#colorHidden').val($('#color').val());
            $('#yearHidden').val($('#year').val());
            $('#detailHidden').val($('#detail').val());

            // --- Hidden --- //
        }
        //---------- PAGE2 ----------//

        function btNextStep3() {
            document.getElementById("step3").style.display = "none";
            document.getElementById("step4").style.display = "block";
        }

        function btBackStep3() {
            document.getElementById("step3").style.display = "none";
            document.getElementById("step2").style.display = "block";
        }

        function validateForm() {
            var x = document.getElementById("form").getElementsByClassName("form-control");
            var email = document.getElementById("email").value;
            var statusInput = false;
            var statusEmail = false;

            for (var i = 0; i < x.length; i++) {
                if (x[i].value == "") {
                    swal("", "กรุณากรอกข้อมูลให้ครบถ้วน", "error")
                    statusInput = false;
                    break;
                } else {
                    statusInput = true;
                }
            }

            if (isValidEmailAddress(email) == false && statusInput) {
                swal("", "อีเมลไม่ถูกกต้อง", "error")
                statusEmail = false;
            } else {
                statusEmail = true;
            }

            if (statusInput && statusEmail) { btNextStep1() }
        }

        function validateForm2() {
            var x = document.getElementById("formStep2").getElementsByClassName("form-control");
            var statusInput = false;

            for (var i = 0; i < x.length; i++) {

                if (x[i].value == "") {
                    swal("", "กรุณากรอกข้อมูลให้ครบถ้วน", "error")
                    statusInput = false;
                    break;
                } else {
                    statusInput = true;
                }
            }
            if (statusInput) {
                btNextStep2();
            }
        }

        function isValidEmailAddress(emailAddress) {
            return /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/.test(emailAddress);
        }

        $(document).ready(function () {
            $("#idCard,#tel,#zipCode").keypress(function (e) {
                if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                    return false;
                }
            });
        });
    </script>